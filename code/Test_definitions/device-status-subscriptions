@DeviceStatusSubscriptionSanity
Feature: CAMARA DeviceStatus Subscription API, v0.5.1 - Operation DeviceStatus
  
  @DeviceStatusSubscription_01_InRoamingEvent
  Scenario: Check roaming event if the device roaming state changed to 'true'
    Given Use BaseURL
    When Create device status subscription for MSISDN +491601111111 and roaming-status event
    Then Response code is 201
    Then Get device status subscription
    Then Response code is 200
    When Wait 10 seconds
    Then The callback notification application receives roaming-status event
    Then The roaming status is true
    Then The country name is
      | DG |
      | GU |
      | US |
    Then The country code is 310
    When Delete device status subscription
    Then Response code is 204

  @DeviceStatusSubscription_02_NotInRoamingEvent
  Scenario: Check roaming event if the device roaming state changed to 'false'
    Given Use BaseURL
    When Create device status subscription for MSISDN +49160333333 and roaming-status event
    Then Response code is 201
    Then Get device status subscription
    Then Response code is 200
    When Wait 10 seconds
    Then The callback notification application receives roaming-status event
    Then The roaming status is false
    Then The country name is
      | DG |
      | GU |
      | US |
    Then The country code is 310
    When Delete device status subscription
    Then Response code is 204

  @DeviceStatusSubscription_03_CountryChangeEvent
  Scenario: Check the country code event if the device in roaming changes a country
    Given Use BaseURL
    When Create device status subscription for MSISDN +49160222222 and change-country event
    Then Response code is 201
    Then Get device status subscription
    Then Response code is 200
    When Wait 10 seconds
    Then The callback notification application receives change-country event
    Then The country name is
      | DE |
    Then The country code is 262
    When Delete device status subscription
    Then Response code is 204

  @DeviceStatusSubscription_04_ConnectivityDataEvent
  Scenario: Check connectivity event if the device connectivity is changed to Data usage
    Given Use BaseURL
    When Create device status subscription for MSISDN +491601111111 and connectivity-data event
    Then Response code is 201
    Then Get device status subscription
    Then Response code is 200
    When Wait 10 seconds
    Then The callback notification application receives connectivity-data event
    When Delete device status subscription
    Then Response code is 204

  @DeviceStatusSubscription_05_ConnectivitySmsEvent
  Scenario: Check connectivity event if the device connectivity is changed to SMS usage
    Given Use BaseURL
    When Create device status subscription for MSISDN +491602222222 and connectivity-sms event
    Then Response code is 201
    Then Get device status subscription
    Then Response code is 200
    When Wait 10 seconds
    Then The callback notification application receives connectivity-sms event
    When Delete device status subscription
    Then Response code is 204

  @DeviceStatusSubscription_06_ConnectivityDisconnectedEvent
  Scenario: Check connectivity event if the device connectivity is changed to disconnected
    Given Use BaseURL
    When Create device status subscription for MSISDN +491609999999 and connectivity-disconnected event
    Then Response code is 201
    Then Get device status subscription
    Then Response code is 200
    When Wait 10 seconds
    Then The callback notification application receives connectivity-disconnected event
    #When Delete device status subscription
    #Then Response code is 204

  @DeviceStatusSubscription_07_SubscriptionEndsEvent
  Scenario: Check device status subscription ends event
    Given Use BaseURL
    When Create device status subscription for duration of 2 seconds
    Then Response code is 201
    Then Get device status subscription
    Then Response code is 200
    When Wait 10 seconds
    Then The callback notification application receives subscription-ends event
    Then Get device status subscription
    Then Response code is 404


  @DeviceStatusSubscription_08_GetSubscriptions
  Scenario: Get all device status event subscriptions
    Given Use BaseURL
    When Create device status subscription for a valid access token with client-id-1, MSISDN +49160222222 and change-country event
    Then Response code is 201
    When Create device status subscription for a valid access token with client-id-1, MSISDN +49160333333 and roaming-status event
    Then Response code is 201
    When Create device status subscription for a valid access token with client-id-2, MSISDN +491602222222 and connectivity-sms event
    Then Response code is 201
    When Get all device status subscriptions for client-id-1
    Then Response code is 200
    Then Number of subscriptions of client-id-1 is 2
    When Get all device status subscriptions for client-id-2
    Then Response code is 200
    Then Number of subscriptions of client-id-2 is 1
    Then Delete subscriptions

  @DeviceStatusSubscription_09_GetSubscriptionsForNotExistingSubscription
  Scenario: Get all device status subscriptions for a client that does not have any subscriptions
    Given Use BaseURL
    When Create device status subscription for a valid access token with client-id-1, MSISDN +491601111111 and connectivity-data event
    Then Response code is 201
    When Get all device status subscriptions for client-id-2
    Then Response code is 200
    Then Number of subscriptions of client-id-2 is 0
    Then Delete subscriptions

  @DeviceStatusSubscription_10_GetSubscriptionsForInvalidToken
  Scenario: Get all device status subscriptions for an invalid access token
    Given Use BaseURL
    When Create device status subscription for a valid access token with client-id-1, MSISDN +49160222222 and change-country event
    Then Response code is 201
    When Get all device status subscriptions for an invalid access token
    Then Response code is 403
    Then Delete subscriptions

  @DeviceStatusSubscription_11_DeviceIncorrectMsisdn
  Scenario: Device status request for an incorrect msisdn
    Given Use BaseURL
    When Request device status with incorrect msisdn in json payload
    Then Response code is 400

  @DeviceStatusSubscription_12_DeviceForPastSubscriptionExpirationTime
  Scenario: Device status request for past subscriptionExpireTime
    Given Use BaseURL
    When Request create device status subscription for subscriptionExpireTime in th past
    Then Response code is 400

  @DeviceStatusSubscription_13_DeviceWithNoMsisdn
  Scenario: Device status request without MSISDN
    Given Use BaseURL
    When Request create device status subscription without MSISDN
    Then Response code is 400
 
  @DeviceStatusSubscription_14_GetSubscriptionsSMS
  Scenario: Get all device status event subscriptions
    Given Use BaseURL
    When Create device status subscription for a valid access token with client-id-2, MSISDN +491609999999 and connectivity-sms event
    Then Response code is 201

  @DeviceStatusSubscription_15_GetSubscriptionsDisconnect
  Scenario: Get all device status event subscriptions
    Given Use BaseURL
    When Create device status subscription for a valid access token with client-id-2, MSISDN +491603333333 and connectivity-disconnected event
    Then Response code is 201
